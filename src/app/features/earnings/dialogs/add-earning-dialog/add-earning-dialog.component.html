<h2 mat-dialog-title>Add New Earning Record</h2>

<form [formGroup]="addForm" (ngSubmit)="onSave()">
  <mat-dialog-content class="add-earning-content">
    <p>Fill in the details for the new earning entry.</p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>User ID</mat-label>
      <input matInput formControlName="userId" required placeholder="Paste User ID Mention (e.g., <@123...>)">
      <mat-error *ngIf="f['userId'].errors?.['required']">User ID is required.</mat-error>
      <mat-error *ngIf="f['userId'].errors?.['pattern']">Invalid format (use &#64;UserID).</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Date</mat-label>
      <input matInput [matDatepicker]="picker" formControlName="date" required readonly placeholder="Select a date"> <!-- Readonly prevents manual typing -->
      <mat-hint>MM/DD/YYYY</mat-hint>
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
      <mat-error *ngIf="f['date'].errors?.['required']">Date is required.</mat-error>
    </mat-form-field>

    <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Gross Revenue ($)</mat-label>
          <input matInput type="number" formControlName="gross_revenue" required min="0" step="0.01" placeholder="0.00">
          <mat-error *ngIf="f['gross_revenue'].errors?.['required']">Required</mat-error>
          <mat-error *ngIf="f['gross_revenue'].errors?.['min']">Must be 0 or more</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Total Cut ($)</mat-label>
          <input matInput type="number" formControlName="total_cut" required min="0" step="0.01" placeholder="0.00">
          <mat-error *ngIf="f['total_cut'].errors?.['required']">Required</mat-error>
          <mat-error *ngIf="f['total_cut'].errors?.['min']">Must be 0 or more</mat-error>
        </mat-form-field>

         <mat-form-field appearance="outline">
          <mat-label>Hours Worked</mat-label>
          <input matInput type="number" formControlName="hours_worked" min="0" step="0.1" placeholder="0.0">
           <mat-error *ngIf="f['hours_worked'].errors?.['min']">Must be 0 or more</mat-error>
        </mat-form-field>
    </div>

    <div class="form-row">
        <mat-form-field appearance="outline">
            <mat-label>Role</mat-label>
             <!-- Use this if you have role names/IDs -->
             <mat-select formControlName="role">
                 <mat-option [value]="null">-- Select Role --</mat-option>
                 <mat-option *ngFor="let role of roles$ | async" [value]="role.name">{{role.name}}</mat-option> <!-- Adjust value/display as needed -->
             </mat-select>
            <!-- <input matInput formControlName="role" placeholder="Enter Role Name"> Placeholder if no select -->
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Model(s)</mat-label>
            <mat-select formControlName="models">
                 <mat-option [value]="null">-- Select Model --</mat-option>
                 <mat-option *ngFor="let model of models$ | async" [value]="model">{{model}}</mat-option>
            </mat-select>
            <!-- <input matInput formControlName="models" placeholder="Enter Model Name(s)"> Placeholder if text input -->
        </mat-form-field>
    </div>

    <div class="form-row">
        <mat-form-field appearance="outline">
              <mat-label>Period</mat-label>
              <mat-select formControlName="period" required>
                   <mat-option [value]="null">-- Select Period --</mat-option>
                   <mat-option *ngFor="let p of periods$ | async" [value]="p">{{p}}</mat-option>
              </mat-select>
              <mat-error *ngIf="f['period'].errors?.['required']">Period is required.</mat-error>
          </mat-form-field>

           <mat-form-field appearance="outline">
              <mat-label>Shift</mat-label>
              <mat-select formControlName="shift" required>
                  <mat-option [value]="null">-- Select Shift --</mat-option>
                   <mat-option *ngFor="let s of shifts$ | async" [value]="s">{{s}}</mat-option>
              </mat-select>
              <mat-error *ngIf="f['shift'].errors?.['required']">Shift is required.</mat-error>
          </mat-form-field>
    </div>

  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-stroked-button type="button" (click)="onCancel()">Cancel</button>
    <!-- Disable save button if form is invalid -->
    <button mat-flat-button color="primary" type="submit" [disabled]="addForm.invalid">Add Record</button>
  </mat-dialog-actions>
</form>
